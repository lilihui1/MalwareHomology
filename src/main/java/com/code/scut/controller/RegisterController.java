package com.code.scut.controller;

import com.code.scut.common.JsonMessage;
import com.code.scut.entity.User;
import com.code.scut.service.UserService;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

import java.util.HashMap;
import java.util.Map;

/**
 * @ClassName RegisterController
 * @Description 注册
 * @Author lilihui
 * @Date 2020/3/24 18:52
 * @Version 1.0
 */
@RestController
@RequestMapping("/malware")
public class RegisterController {
    /** 记录日志 */
    private static final Logger logger = LoggerFactory.getLogger(RegisterController.class);

    @Autowired
    private UserService userService;

    @RequestMapping(value = "/register",method = RequestMethod.POST)
    public JsonMessage register(@RequestBody Map<String, String> params)throws Exception{
        String name = params.get("name");
        String password = params.get("password");
        String email = params.get("email");
        //这里还要考虑判断一下用户名重复的
        User userTemp = userService.getUserByName(name);
        if (userTemp!=null){
            logger.error("context: "+"名字重复");
            return new JsonMessage(false,"-1","名字重复",null);
        }

        try {

            User user = new User();
            user.setEmail(email);
            user.setName(name);
            user.setPassword(password);
            user.setRole("normalUser");
            user.setStatus("1");
            int tempId = userService.insertUser(user);
            Map resultMap = new HashMap();
            resultMap.put("name: ",user.getName());
            resultMap.put("password: ",user.getPassword());
            resultMap.put("email: ",user.getEmail());
            resultMap.put("userId: ",user.getUserId());
            return new JsonMessage(true,"1","成功",resultMap);
        }catch (Exception e){
            logger.error("context: "+e);
            return new JsonMessage(false,"-1","失败",null);
        }

    }
}
