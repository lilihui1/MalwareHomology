<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.code.scut.dao.SampleMapper" >
    <resultMap id="SampleMap" type="com.code.scut.entity.Sample">
        <id column="SampleId" property="sampleId" jdbcType="INTEGER"/>
        <result column="Md5" property="md5" jdbcType="VARCHAR" />
        <result column="FileName" property="fileName" jdbcType="VARCHAR" />
        <result column="UserId" property="userId" jdbcType="INTEGER" />
        <result column="FileType" property="fileType" jdbcType="VARCHAR" />
        <result column="Status" property="status" jdbcType="VARCHAR" />
        <result column="TaskId" property="taskId" jdbcType="INTEGER" />
        <result column="FileSize" property="fileSize" jdbcType="VARCHAR" />
        <result column="UploadTime" property="uploadTime" javaType="java.util.Date" jdbcType="TIMESTAMP" />
        <result column="BeginExecuteTime" property="beginExecuteTime" javaType="java.util.Date" jdbcType="TIMESTAMP" />
        <result column="EndExecuteTime" property="endExecuteTime" javaType="java.util.Date" jdbcType="TIMESTAMP" />
        <result column="PredictStatus" property="predictStatus" jdbcType="VARCHAR" />
        <result column="APIPath" property="apiPath" jdbcType="VARCHAR" />
        <result column="Valid" property="valid" jdbcType="VARCHAR" />
    </resultMap>
    <sql id="Base_Column_List" >
    tm.SampleId,tm.Md5,tm.FileName,tm.UserId,tm.FileType,tm.Status,tm.TaskId,tm.FileSize,tm.UploadTime,tm.BeginExecuteTime,tm.EndExecuteTime,tm.PredictStatus,tm.APIPath,tm.Valid
    </sql>

    <insert id="insertSample" parameterType="com.code.scut.entity.Sample" useGeneratedKeys="true" keyProperty="sampleId" keyColumn="SampleId">
     insert into mal_sample (Md5,FileName,UserId,FileType,Status,TaskId,FileSize,UploadTime,BeginExecuteTime,EndExecuteTime,PredictStatus,APIPath,Valid)
     values (#{md5},#{fileName},#{userId},#{fileType},#{status},#{taskId},#{fileSize},#{uploadTime},#{beginExecuteTime},#{endExecuteTime},#{predictStatus},#{apiPath},#{valid})
    </insert>

    <update id="updateSampleStatus" >
        UPDATE mal_sample
        <set>
            <if test="status!=null" >
                Status=#{status},
            </if>
        </set>
        WHERE SampleId=#{sampleId} AND UserId=#{userId}
    </update>

    <update id="updateSamplePredictStatus" >
        UPDATE mal_sample
        <set>
            <if test="predictStatus!=null" >
                PredictStatus=#{predictStatus},
            </if>
        </set>
        WHERE SampleId=#{sampleId} AND UserId=#{userId}
    </update>

    <update id="updateSampleAPIPath" >
        UPDATE mal_sample
        <set>
            <if test="pathName!=null" >
                APIPath=#{pathName},
            </if>
        </set>
        WHERE SampleId=#{sampleId} AND UserId=#{userId}
    </update>

    <update id="deleteSample" >
        UPDATE mal_sample
        <set>
            <if test="sampleId!=null" >
                Valid='0',
            </if>
        </set>
        WHERE SampleId=#{sampleId} AND UserId=#{userId}
    </update>

    <select id="getSampleById" resultMap="SampleMap">
        SELECT
        <include refid="Base_Column_List" />
        FROM mal_sample tm WHERE tm.UserId = #{userId} and tm.SampleId = #{sampleId}
    </select>

    <select id="getAPIPath" resultType="java.lang.String" >
        SELECT APIPath FROM mal_sample tm WHERE tm.UserId = #{userId} and tm.SampleId = #{sampleId}
    </select>

    <select id="getSampleTaskId" resultType="java.lang.Integer">
        SELECT IFNULL(TaskId,0) FROM mal_sample tm WHERE tm.UserId = #{userId} and tm.SampleId = #{sampleId}
    </select>

    <select id="getSampleList" resultMap="SampleMap">
        SELECT
        <include refid="Base_Column_List" />
        FROM mal_sample tm WHERE tm.UserId = #{userId} and tm.Valid = '1'
    </select>

    <select id="getMD5" resultType="java.lang.String">
        SELECT Md5 FROM mal_sample tm WHERE tm.UserId = #{userId} and tm.SampleId = #{sampleId}
    </select>

    <select id="getFileType" resultType="java.lang.String">
        SELECT FileType FROM mal_sample tm WHERE tm.UserId = #{userId} and tm.SampleId = #{sampleId}
    </select>

    <update id="updateSample" >
        UPDATE mal_sample
        <set>
            Status=#{status},
            BeginExecuteTime=#{beginExecuteTime},
            EndExecuteTime=#{endExecuteTime}
        </set>
        WHERE SampleId=#{sampleId} AND UserId=#{userId}
    </update>


</mapper>