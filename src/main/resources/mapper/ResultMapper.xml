<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.code.scut.dao.ResultMapper" >
    <resultMap id="ResultMap" type="com.code.scut.entity.Result">
        <id column="ResultId" property="resultId" jdbcType="INTEGER"/>
        <result column="TreeJsonPath" property="treeJsonPath" jdbcType="VARCHAR" />
        <result column="PredictedFamily" property="predictedFamily" jdbcType="VARCHAR" />
        <result column="BehaviorCharacter" property="behaviorCharacter" jdbcType="VARCHAR" />
        <result column="FamilySimilarity" property="familySimilarity" jdbcType="VARCHAR" />
        <result column="SampleId" property="sampleId" jdbcType="INTEGER" />
        <result column="UserId" property="userId" jdbcType="INTEGER" />
        <result column="Md5" property="md5" jdbcType="VARCHAR" />
    </resultMap>
    <sql id="Base_Column_List" >
    tm.ResultId, tm.TreeJsonPath,tm.PredictedFamily,tm.BehaviorCharacter,tm.FamilySimilarity,tm.SampleId,tm.UserId,tm.Md5
    </sql>

    <insert id="insertResult" parameterType="com.code.scut.entity.Result" useGeneratedKeys="true" keyProperty="resultId" keyColumn="ResultId">
     insert into mal_result (TreeJsonPath,PredictedFamily,BehaviorCharacter,FamilySimilarity,SampleId,UserId,Md5)
     values (#{treeJsonPath},#{predictedFamily},#{behaviorCharacter},#{familySimilarity},#{sampleId},#{userId},#{md5})
    </insert>

    <select id="getResultList" resultMap="ResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM mal_result tm WHERE tm.UserId = #{userId} and tm.SampleId = #{sampleId}
    </select>

    <select id="getPredictFamily" resultType="java.lang.String">
        SELECT PredictedFamily
        FROM mal_result tm
        WHERE tm.UserId = #{userId} and tm.SampleId = #{sampleId}
    </select>

    <select id="getTree" resultType="java.lang.String">
        SELECT TreeJsonPath
        FROM mal_result tm
        WHERE tm.UserId = #{userId} and tm.SampleId = #{sampleId}
    </select>

    <select id="getBehaviorCharacter" resultType="java.lang.String">
        SELECT BehaviorCharacter
        FROM mal_result tm
        WHERE tm.UserId = #{userId} and tm.SampleId = #{sampleId}
    </select>

    <select id="getFamilySimilarity" resultType="java.lang.String">
        SELECT FamilySimilarity
        FROM mal_result tm
        WHERE tm.UserId = #{userId} and tm.SampleId = #{sampleId}
    </select>

    <update id="updatePredictFamily" >
        UPDATE mal_result
        <set>
            TreeJsonPath=#{treeJsonPath},
            PredictedFamily=#{predictedFamily},
            BehaviorCharacter=#{behaviorCharacter},
            FamilySimilarity=#{familySimilarity}
        </set>
        WHERE SampleId=#{sampleId} AND UserId=#{userId}
    </update>

</mapper>